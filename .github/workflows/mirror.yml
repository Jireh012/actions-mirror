name: Mirror actions
run-name: mirror actions

on:
  push:
  schedule:
    - cron:  '0 */12 * * *' # every 12 hours on the hour
jobs:
  mirrors:
    strategy:
      matrix:
        include:
          - dest: "actions-mirror/checkout"
            source: "actions/checkout"
          - dest: "actions-mirror/stale"
            source: "actions/stale"
          - dest: "actions-mirror/docker-metadata-action"
            source: "docker/metadata-action"
          - dest: "actions-mirror/docker-setup-qemu-action"
            source: "docker/setup-qemu-action"
          - dest: "actions-mirror/docker-build-push-action"
            source: "docker/build-push-action"
          - dest: "actions-mirror/docker-setup-buildx-action"
            source: "docker/setup-buildx-action"
          - dest: "actions-mirror/docker-login-action"
            source: "docker/login-action"
          - dest: "actions-mirror/setup-dotnet"
            source: "actions/setup-dotnet"
          - dest: "actions-mirror/download-artifact"
            source: "actions/download-artifact"
          - dest: "actions-mirror/upload-artifact"
            source: "actions/upload-artifact"
          - dest: "actions-mirror/setup-python"
            source: "actions/setup-python"
          - dest: "actions-mirror/setup-node"
            source: "actions/setup-node"
          - dest: "actions-mirror/setup-go"
            source: "actions/setup-go"
          - dest: "actions-mirror/cache"
            source: "actions/cache"
          - dest: "actions-mirror/setup-java"
            source: "actions/setup-java"
          - dest: "actions-mirror/setup-maven"
            source: "stCarolas/setup-maven"
          - dest: "actions-mirror/maven-settings-action"
            source: "s4u/maven-settings-action"
          - dest: "actions-mirror/goreleaser-action"
            source: "goreleaser/goreleaser-action"
          - dest: "actions-mirror/bot-notice-action"
            source: "hb0730/bot-notice-action"
          - dest: "actions-mirror/maven-action"
            source: "hb0730/maven-action"
          
    runs-on: ubuntu-latest
    steps:
      - name: mirror github.com/${{ matrix.source }} to gitee.com/${{ matrix.dest }}
        run: |
          git clone --mirror https://github.com/${{ matrix.source }} ./${{ matrix.source }}
          cd ./${{ matrix.source }}
          git remote add gitee https://oauth2:${{ secrets.ACTIONS_TOKEN }}@gitee.com/${{ matrix.dest }}.git
          # https://stackoverflow.com/questions/47776357/git-push-mirror-without-pull-refs
          git show-ref | cut -d' ' -f2 | grep 'pull' | xargs -r -L1 git update-ref -d
          git push -f gitee --mirror


